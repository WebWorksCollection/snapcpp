<?xml version="1.0"?>
<!--
Snap Websites Server == feed plugin database setup
Copyright (C) 2013-2014  Made to Order Software Corp.

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-->
<snap-tree>
  <!-- we prevent shorturl's on the home page -->
  <content path="/" owner="output">
    <link name="feed::feed" to="feed::feed" mode="*:*">/types/taxonomy/system/feed/main</link>
  </content>
  <content path="/admin/feed" owner="output">
    <param name="content::title" revision="revision">Website Feeds Settings</param>
    <param name="content::body" revision="revision">
      <![CDATA[<p>Sitewide Feed Settings.</p>]]>
    </param>
    <param name="permissions::dynamic" type="int8" revision="global">1</param>
    <link name="content::page_type" to="content::page" mode="1:*">/types/taxonomy/system/content-types/page/public</link>
    <link name="permissions::direct::action::administer" to="permissions::link_back" mode="*:*">/types/permissions/rights/administer/website</link>
  </content>
  <content path="/feed" owner="output">
    <param name="content::title" revision="revision">Website Feeds</param>
    <param name="content::body" revision="revision">
      <![CDATA[<p>List of available feeds for this website.</p>]]>
    </param>
    <!--param name="permissions::dynamic" type="int8" revision="global">1</param-->
    <!-- although the feeds themselves are always changing this page not so much -->
    <param name="sitemapxml::frequency">0.1</param>
    <link name="content::page_type" to="content::page" mode="1:*">/types/taxonomy/system/content-types/page/public</link>
    <link name="shorturl::no_shorturl" to="shorturl::no_shorturl" mode="1:*">/types/taxonomy/system/shorturl/no_shorturl</link>
    <link name="sitemapxml::include" to="sitemapxml::include" mode="1:*">/types/taxonomy/system/sitemapxml/include</link>
  </content>
  <content path="/feed/main" owner="list">
    <param name="content::title" revision="revision">Main Website Feed</param>
    <param name="content::body" revision="revision">
      <![CDATA[<p>The following is a list of pages composing the main website feed.</p>[list::theme(path = "/feed/main", count = 100)]]]>
    </param>
    <param name="list::original_item_key_script" overwrite="yes">
      <![CDATA[(branch := int32(cell("content", page, "content::revision_control::current_branch")),
                key := string(cell("content", page, "content::revision_control::current_revision_key::" + branch + "::en")),
                key ? string(cell("revision", key, "content::title")) : "no title")]]>
    </param>
    <param name="list::original_test_script" overwrite="yes">
      <!-- avoid administrative pages, always
           also the permissions should be enough to not include admin/...
           pages to this feed, here we only add pages that anonomous users
           can view (pretty much all RSS feeds are expected to only send
           public data anyway) -->
      <![CDATA[!strmatch("^admin/", path)
            && linked_to("feed::feed", page, "types/taxonomy/system/feed/main")
            && perms(path, "user", "view", "visitor")]]>
    </param>
    <param name="list::selector" overwrite="yes"><![CDATA[type=types/taxonomy/system/feed/main]]></param>
    <!--param name="permissions::dynamic" type="int8" revision="global">1</param-->
    <!-- although the feeds themselves are always changing this page not so much -->
    <link name="content::page_type" to="content::page" mode="1:*">/types/taxonomy/system/content-types/page/public</link>
    <link name="permissions::direct::action::administer" to="permissions::link_back" mode="*:*">/types/permissions/rights/administer/website</link>
  </content>
  <content path="/types/taxonomy/system/feed" owner="output">
    <param name="content::title" revision="revision">Feed Tags</param>
    <param name="content::body" revision="revision">
      <![CDATA[<p>Tags defined under this one are used to mark pages that are to be added to a feed.</p>]]>
    </param>
  </content>
  <content path="/types/taxonomy/system/feed/main" owner="output">
    <param name="content::title" revision="revision">Main Feed</param>
    <param name="content::body" revision="revision">
      <![CDATA[<p>Mark pages with this tag to add them to your website main feed.</p>]]>
    </param>
  </content>
</snap-tree>
<!-- vim: ts=2 sw=2 et syntax=xml
-->
