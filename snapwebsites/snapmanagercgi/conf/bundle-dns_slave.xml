<?xml version="1.0"?>
<!--
  see /usr/share/snapwebsites/xsd/bundles.xsd for details
  to verify your changes (change the == with two dashes):
    xmllint ==noout ==schema /usr/share/snapwebsites/xsd/bundles.xsd /etc/snapwebsites/services.d/bundle-tools.xml
-->
<bundle>
  <name>dns_slave</name>
  <description>
    <p>This bundle installs the Domain Name Server (bind9) on your machine.</p>
  </description>
  <fields>
    <field name="domain" type="input">
      <label>Domain</label>
      <description>
        The name of the domain used for this secondary DNS server.
        For example: "snapwebsites.net"

        Note: this is for a "slave" DNS server, which will copy info from the primary.
        When you set up your DNS server, that will be "ns1", and this will be "ns2".
      </description>
    <field name="nameserver_1" type="input">
      <label>Nameserver 1</label>
      <description>
        Input the address of the primary nameserver (ns1).
      </description>
    </field>
    </field>
  </fields>
  <packages>bind9</packages>
  <postinst>

    ################################################################################
    # Set up the named.conf.local file
    #
    cat &gt;&gt; /etc/bind/named.conf.local &lt;&lt;EOF
zone "${BUNDLE_INSTALLATION_DOMAIN}" {
        type slave;
        file "/var/cache/bind/${BUNDLE_INSTALLATION_DOMAIN}.zone";
        masters { ${BUNDLE_INSTALLATION_NAMESERVER_1}; };
        allow-transfer { none; };
};
EOF

    ################################################################################
    # (re)start service(s) with the correct parameters
    #
    # also the tripwire bundle may disable postfix so here we make sure
    # it is enabled
    #
    for i in bind9
    do
      systemctl enable  $i
      systemctl restart $i
    done
  </postinst>
</bundle>
<!--
  vim: ts=2 sw=2 et
-->
