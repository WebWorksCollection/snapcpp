<?xml version="1.0"?>
<!-- see bundles.xsd for details -->
<bundle>
  <name>frontend</name>
  <description>
    <p>The frontend bundle installs Apache2 and snap.cgi which together
    handle client requests and determine whether to proxy the request
    to a snapserver.</p>

    <p>It is expected to be installed only on frontend computers.</p>

    <p>You should not install this bundle on any of your backend
    computer. If you want to run snapmanager.cgi on a backend,
    it will not involve snap.cgi at all.</p>
  </description>
  <fields>
    <field name="webmaster_email" type="input">
      <label>Webmaster Email Address</label>
      <description>
        The email address of the website. Note that all the websites
        running on a Snap! Websites cluster make use of the same
        Apache definition. So this is expected to be the main
        maintainer of the Snap! Websites system.
      </description>
    </field>
    <field name="domain_name" type="input">
      <label>Domain Name</label>
      <description>
        The default domain name to use for your Snap! Websites. This
        should have no effect to the other websites, so the system
        will be accessible whatever the domain name, really. However,
        Apache2 tends to use the default domain name in case an
        error occurs or the website is accessed by an IP address.
      </description>
    </field>
  </fields>
  <packages>apache2, snapcgi</packages>
  <postinst>
    systemctl stop apache2

    # The snap-httpoxy is part of snapbase, but if apache2 was not yet
    # installed when snapbase got installed, then this command did not
    # run, so run it now to make sure it is effective
    #
    a2enconf snap-httpoxy

    # enable our SSL log extension (i.e. showing SSL protocol and cipher)
    #
    a2enconf snap-apache2-ssl-log

    # setup the default apache2 configuration file
    #
    sed -i.bak \
        -e "s/snap.example.com/$BUNDLE_INSTALLATION_DOMAIN_NAME/" \
        -e "s/webmaster@example.com/$BUNDLE_INSTALLATION_WEBMASTER_EMAIL/" \
              /etc/apache2/sites-available/snap-apache2-default.conf

    # enable this configuration as the default
    #
    a2dissite 000-default
    a2ensite 000-snap-apache2-default

    systemctl start apache2
  </postinst>
</bundle>
<!--
  vim: ts=2 sw=2 et
-->
