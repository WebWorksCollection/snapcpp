#
#                  PLEASE DO NOT EDIT!
#
# The following is a default, read-only, apache2 configuration coming with Snap!
#
# For details, please read this README.md file:
#
#     /etc/apache2/snap-conf/README.md
#

# If you instead want to force all users to access HTTPS instead of HTTP
# you may use a redirect
<VirtualHost *:80>
  # Retrieve the user definitions
  #
  Include /etc/apache2/snap-conf/default/000-snap-apache2-default-common.conf
  Include /etc/apache2/snap-conf/default/000-snap-apache2-default-80.conf
  Include /etc/apache2/snap-conf/snap-apache2-maintenance.conf
  Include /etc/apache2/snap-conf/snap-apache2-vhost-security.conf
  # definitions after the user definitions overwrite whatever the user
  # may have entered...

  # We have to have a document root, preferably one that exists
  #
  DocumentRoot /var/www/html/

  # Error and other logs
  #
  ErrorLog /var/log/apache2/snap-default-error.log
  CustomLog /var/log/apache2/snap-default-access.log vhost_combined

  # Permanently redirect to port 443 with an HTTP 301 code
  #
  RewriteEngine on
  RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [last,qsappend,redirect=permanent]
</VirtualHost>


# Secure site (port 443 is HTTPS)
<VirtualHost *:443>
  # Retrieve the user definitions
  #
  Include /etc/apache2/snap-conf/default/000-snap-apache2-default-common.conf
  Include /etc/apache2/snap-conf/default/000-snap-apache2-default-443.conf
  Include /etc/apache2/snap-conf/snap-apache2-maintenance.conf
  Include /etc/apache2/snap-conf/snap-apache2-vhost-security.conf
  # definitions after the user definitions overwrite whatever the user
  # may have entered...

  # We have to have a document root, preferably one that exists
  #
  DocumentRoot /var/www/html/

  # Error and other logs
  #
  ErrorLog /var/log/apache2/snap-default-error.log
  CustomLog /var/log/apache2/snap-default-access.log vhost_combined_ssl

  # Do not show directory contents
  # (note that we also remove the autoindex module, but in case someone
  # was to re-enable it...)
  #
  <Directory "/var/www/html/">
    Options -Indexes
  </Directory>

  # For details about the rewrite engine check out the Apache documentation:
  #   http://httpd.apache.org/docs/current/mod/mod_rewrite.html
  #
  RewriteEngine on

  # Do not re-rewrite /cgi-bin requests (Skip next rule)
  # (however, we will fail with a 404 on all of those)
  #
  RewriteRule ^/cgi-bin/snap\.cgi|^/snap-maintenance/ - [skip=1]
  # Rewrite anything else as a /cgi-bin/snap.cgi request
  RewriteRule ^(.*)$ /cgi-bin/snap.cgi [last,passthrough,qsappend]

  # Include our SSL options, that includes turning ON the SSL engine
  #
  Include /etc/apache2/ssl-snap/snap-apache2-ssl.conf
</VirtualHost>

# vim: ts=2 sw=2 et syntax=apache
